-- ======= Services =======
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local Remote = ReplicatedStorage:WaitForChild("RemoteEvents"):WaitForChild("RequestTakeDiamonds")

-- ======= Hop Server =======
local function hopServer()
    local gameId = game.PlaceId
    local success, body = pcall(function()
        return game:HttpGet(("https://games.roblox.com/v1/games/%d/servers/Public?sortOrder=Asc&limit=100"):format(gameId))
    end)

    if success then
        local data = HttpService:JSONDecode(body)
        for _, server in ipairs(data.data) do
            if server.playing < server.maxPlayers and server.id ~= game.JobId then
                if queue_on_teleport then
                    queue_on_teleport([[
                        loadstring(game:HttpGet("https://raw.githubusercontent.com/wyaSwift/ee/refs/heads/main/dd"))()
                    ]])
                end
                pcall(function()
                    TeleportService:TeleportToPlaceInstance(gameId, server.id, LocalPlayer)
                end)
                return
            end
        end
    end
    task.wait(3)
    hopServer()
end

-- ======= Farm Diamonds =======
local function farmDiamonds()
    repeat task.wait() until LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")

    local chest = workspace.Items:FindFirstChild("Stronghold Diamond Chest")
    if not chest then
        hopServer()
        return
    end

    LocalPlayer.Character:PivotTo(CFrame.new(chest:GetPivot().Position))

    local proxPrompt
    repeat
        task.wait(0.1)
        local prox = chest:FindFirstChild("Main")
        if prox and prox:FindFirstChild("ProximityAttachment") then
            proxPrompt = prox.ProximityAttachment:FindFirstChild("ProximityInteraction")
        end
    until proxPrompt

    local startTime = tick()
    while proxPrompt and proxPrompt.Parent and (tick() - startTime) < 10 do
        pcall(function()
            fireproximityprompt(proxPrompt)
        end)
        task.wait(0.2)
    end

    local diamonds = {}
    for _, v in pairs(workspace:GetDescendants()) do
        if v.ClassName == "Model" and v.Name == "Diamond" then
            table.insert(diamonds, v)
        end
    end

    local totalDiamonds = #diamonds
    for _, v in pairs(diamonds) do
        pcall(function()
            Remote:FireServer(v)
        end)
    end

    -- Kick showing total diamonds collected and hop
    LocalPlayer:Kick("Collected " .. totalDiamonds .. " diamonds! Teleporting...")
    hopServer()
end

-- ======= Loop Indefinitely =======
while true do
    farmDiamonds()
end
